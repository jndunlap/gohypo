{{define "main.html"}}
<!DOCTYPE html>
<html lang="en" class="h-screen">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>{{.Title}}</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10/dist/ext/ws.js"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10/dist/ext/sse.js"></script>
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/research.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&family=IBM+Plex+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        // #region agent log
        fetch('http://127.0.0.1:7243/ingest/1db1170e-452a-479c-8fab-50abd9603c45',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'ui/templates/base.html:17',message:'Page loading started',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'initial',hypothesisId:'H3'})}).catch(()=>{});
        // #endregion
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Global Resets for Clean Light Mode */
        * {
            text-rendering: optimizeLegibility;
        }

        /* Dynamic Panel Layout Styles */
        #main-layout > * {
            /* All panels should be able to flex */
            flex-shrink: 0;
            /* Only center panel should grow */
        }

        #center-panel {
            /* Center panel should take all available space */
            flex: 1 1 auto;
            min-width: 0; /* Allow flex item to shrink below content size */
            max-width: none; /* Allow unlimited expansion */
        }

        /* Smooth transitions for panel visibility changes */
        #main-layout > *.hidden {
            display: none !important;
        }

        /* Loading and interaction states */
        .htmx-loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .redacted-block {
            background: linear-gradient(90deg, #f3f4f6 25%, #e5e7eb 50%, #f3f4f6 75%);
            background-size: 200% 100%;
            animation: redacted-pulse 1.5s ease-in-out infinite;
        }

        @keyframes redacted-pulse {
            0%, 100% { background-position: 200% 0; }
            50% { background-position: -200% 0; }
        }

        /* Hypothesis expansion states */
        .hypothesis-expanded {
            transition: all 0.2s ease-in-out;
        }

        .hypothesis-expanded.hidden {
            display: none !important;
            opacity: 0;
            max-height: 0;
            overflow: hidden;
        }

        .hypothesis-expanded:not(.hidden) {
            display: block !important;
            opacity: 1;
            max-height: 1000px; /* Adjust based on content */
        }

        .hypothesis-arrow {
            transition: transform 0.2s ease-in-out;
        }

        .hypothesis-arrow.rotate-180 {
            transform: rotate(180deg);
        }
</style>
</head>
<body class="bg-white text-gray-900 font-sans selection:bg-blue-500 selection:text-white h-screen">
    <!-- Unified Header -->
    {{template "unified_header" .}}

    <!-- Content -->
    <div id="main-layout" class="h-screen bg-white flex overflow-hidden pt-14 transition-all duration-300 ease-in-out">
        <!-- Far Left Panel - Workspace Panel -->
        {{template "workspace_sidebar" .}}

        <!-- left Panel - DataSpace Blocks -->
        {{template "left_sidebar" .}}

        <!-- Center Panel - Research Workspace -->
        {{template "center_panel" .}}

        <!-- Left Panel - Hypothesis Panel -->
        {{template "hypothesis_panel_left" .}}

    </div>


    <!-- Clean Layout - No Registration Marks Needed -->


    <!-- Research UI Scripts - HTMX Progressive Enhancement -->
    <script src="/static/js/ui-enhancements.js"></script>
    <script src="/static/js/form-helpers.js"></script>
    <script src="/static/js/research-progressive.js"></script>
    <script src="/static/js/data-landscape.js"></script>
    
    <!-- HTMX Configuration -->
    <script>
        // Global HTMX config
        htmx.config.globalViewTransitions = true;
        htmx.config.useTemplateFragments = true;

        // Obsidian Terminal Behaviors
        document.addEventListener('DOMContentLoaded', function() {
            // Redacted Reveal Effect for Loading Data
            const dataElements = document.querySelectorAll('.neo-data');
            dataElements.forEach(el => {
                el.classList.add('redacted-reveal');
            });
        });

        // Loading indicators with Redacted Effect
        document.body.addEventListener('htmx:beforeRequest', function(evt) {
            const btn = evt.target.querySelector('button[type="submit"], button[aria-busy]');
            if (btn) {
                btn.setAttribute('aria-busy', 'true');
                btn.innerHTML = '<span class="redacted-block">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span>';
            }
            // Add loading class to target
            let target;
            if (typeof evt.detail.target === 'string') {
                target = document.querySelector(evt.detail.target);
            } else if (evt.detail.target instanceof Element) {
                target = evt.detail.target;
            }
            if (target) {
                target.classList.add('htmx-loading');
                target.innerHTML = '<div class="redacted-block">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</div>';
            }
        });

        document.body.addEventListener('htmx:afterRequest', function(evt) {
            const btn = evt.target.querySelector('button[aria-busy]');
            if (btn) {
                btn.removeAttribute('aria-busy');
            }
            // Remove loading class from target
            let target;
            if (typeof evt.detail.target === 'string') {
                target = document.querySelector(evt.detail.target);
            } else if (evt.detail.target instanceof Element) {
                target = evt.detail.target;
            }
            if (target) {
                target.classList.remove('htmx-loading');
            }

            // Trigger Impact Shake on successful validation
            if (evt.detail.successful) {
                triggerImpactShake();
            }
        });

        // Error handling
        document.body.addEventListener('htmx:responseError', function(evt) {
            console.error('HTMX Error:', evt.detail);
            // Could show toast notification here
        });

        // Dynamic Cursor Crosshair Expansion
        document.addEventListener('mousemove', function(e) {
            const cursorCrosshair = document.querySelector('.cursor-crosshair');
            if (cursorCrosshair) {
                const rect = cursorCrosshair.getBoundingClientRect();
                const distance = Math.sqrt(
                    Math.pow(e.clientX - (rect.left + rect.width / 2), 2) +
                    Math.pow(e.clientY - (rect.top + rect.height / 2), 2)
                );
                const maxDistance = 200;
                const scale = Math.max(0.5, Math.min(1.5, 1 - (distance / maxDistance)));
                document.documentElement.style.setProperty('--cursor-scale', scale);
            }
        });

        // Define missing functions
        function triggerImpactShake() {
            // Simple visual feedback - could be enhanced with CSS animations
            console.log('[UI] Impact shake triggered (placeholder)');
        }

        // Hypothesis card toggle functions
        function toggleHypothesisCard(element) {
            try {
                console.log('[Hypothesis] Toggle clicked for card:', element.dataset.hypothesisId);

                // Validate element has required dataset
                if (!element || !element.dataset || !element.dataset.hypothesisId) {
                    console.error('[Hypothesis] Invalid element passed to toggleHypothesisCard - missing hypothesisId');
                    if (element) element.style.border = '2px solid red';
                    return;
                }

                const expanded = element.querySelector('.hypothesis-expanded');
                const arrow = element.querySelector('.hypothesis-arrow');

                // Validate required DOM elements exist
                if (!expanded) {
                    console.error('[Hypothesis] Could not find .hypothesis-expanded element in card:', element.dataset.hypothesisId);
                    element.style.border = '2px solid red';
                    element.style.backgroundColor = '#fee2e2';
                    return;
                }

                if (!arrow) {
                    console.warn('[Hypothesis] Could not find .hypothesis-arrow element in card:', element.dataset.hypothesisId, '- arrow animation disabled');
                }

                const isHidden = expanded.classList.contains('hidden');
                console.log('[Hypothesis] Current state - hidden:', isHidden, 'for card:', element.dataset.hypothesisId);

                if (isHidden) {
                    // Expand
                    expanded.classList.remove('hidden');
                    if (arrow) {
                        arrow.classList.add('rotate-180');
                        arrow.setAttribute('aria-expanded', 'true');
                    }
                    console.log('[Hypothesis] âœ… Expanded card:', element.dataset.hypothesisId);
                } else {
                    // Collapse
                    expanded.classList.add('hidden');
                    if (arrow) {
                        arrow.classList.remove('rotate-180');
                        arrow.setAttribute('aria-expanded', 'false');
                    }
                    console.log('[Hypothesis] âœ… Collapsed card:', element.dataset.hypothesisId);
                }

                // Clear any error styling
                element.style.border = '';
                element.style.backgroundColor = '';

            } catch (error) {
                console.error('[Hypothesis] ðŸš¨ Error toggling card expansion:', error, 'for card:', element?.dataset?.hypothesisId || 'unknown');
                if (element) {
                    element.style.border = '2px solid #dc2626';
                    element.style.backgroundColor = '#fee2e2';
                }
            }
        }

        function toggleHypothesisGrid(element) {
            try {
                console.log('[Hypothesis] Toggle clicked for grid item:', element.dataset.hypothesisId);

                // Validate element has required dataset
                if (!element || !element.dataset || !element.dataset.hypothesisId) {
                    console.error('[Hypothesis] Invalid element passed to toggleHypothesisGrid - missing hypothesisId');
                    if (element) element.style.border = '2px solid red';
                    return;
                }

                const expanded = element.querySelector('.hypothesis-expanded');
                const arrow = element.querySelector('.hypothesis-arrow');

                // Validate required DOM elements exist
                if (!expanded) {
                    console.error('[Hypothesis] Could not find .hypothesis-expanded element in grid item:', element.dataset.hypothesisId);
                    element.style.border = '2px solid red';
                    element.style.backgroundColor = '#fee2e2';
                    return;
                }

                if (!arrow) {
                    console.warn('[Hypothesis] Could not find .hypothesis-arrow element in grid item:', element.dataset.hypothesisId, '- arrow animation disabled');
                }

                const isHidden = expanded.classList.contains('hidden');
                console.log('[Hypothesis] Current state - hidden:', isHidden, 'for grid item:', element.dataset.hypothesisId);

                if (isHidden) {
                    // Expand
                    expanded.classList.remove('hidden');
                    if (arrow) {
                        arrow.classList.add('rotate-180');
                        arrow.setAttribute('aria-expanded', 'true');
                    }
                    console.log('[Hypothesis] âœ… Expanded grid item:', element.dataset.hypothesisId);
                } else {
                    // Collapse
                    expanded.classList.add('hidden');
                    if (arrow) {
                        arrow.classList.remove('rotate-180');
                        arrow.setAttribute('aria-expanded', 'false');
                    }
                    console.log('[Hypothesis] âœ… Collapsed grid item:', element.dataset.hypothesisId);
                }

                // Clear any error styling
                element.style.border = '';
                element.style.backgroundColor = '';

            } catch (error) {
                console.error('[Hypothesis] ðŸš¨ Error toggling grid item expansion:', error, 'for grid item:', element?.dataset?.hypothesisId || 'unknown');
                if (element) {
                    element.style.border = '2px solid #dc2626';
                    element.style.backgroundColor = '#fee2e2';
                }
            }
        }

        function toggleHypothesisList(element) {
            try {
                console.log('[Hypothesis] Toggle clicked for list item:', element.dataset.hypothesisId);

                // Validate element has required dataset
                if (!element || !element.dataset || !element.dataset.hypothesisId) {
                    console.error('[Hypothesis] Invalid element passed to toggleHypothesisList - missing hypothesisId');
                    if (element) element.style.border = '2px solid red';
                    return;
                }

                const expanded = element.querySelector('.hypothesis-expanded');
                const arrow = element.querySelector('.hypothesis-arrow');

                // Validate required DOM elements exist
                if (!expanded) {
                    console.error('[Hypothesis] Could not find .hypothesis-expanded element in list item:', element.dataset.hypothesisId);
                    element.style.border = '2px solid red';
                    element.style.backgroundColor = '#fee2e2';
                    return;
                }

                if (!arrow) {
                    console.warn('[Hypothesis] Could not find .hypothesis-arrow element in list item:', element.dataset.hypothesisId, '- arrow animation disabled');
                }

                const isHidden = expanded.classList.contains('hidden');
                console.log('[Hypothesis] Current state - hidden:', isHidden, 'for list item:', element.dataset.hypothesisId);

                if (isHidden) {
                    // Expand
                    expanded.classList.remove('hidden');
                    if (arrow) {
                        arrow.classList.add('rotate-180');
                        arrow.setAttribute('aria-expanded', 'true');
                    }
                    console.log('[Hypothesis] âœ… Expanded list item:', element.dataset.hypothesisId);
                } else {
                    // Collapse
                    expanded.classList.add('hidden');
                    if (arrow) {
                        arrow.classList.remove('rotate-180');
                        arrow.setAttribute('aria-expanded', 'false');
                    }
                    console.log('[Hypothesis] âœ… Collapsed list item:', element.dataset.hypothesisId);
                }

                // Clear any error styling
                element.style.border = '';
                element.style.backgroundColor = '';

            } catch (error) {
                console.error('[Hypothesis] ðŸš¨ Error toggling list item expansion:', error, 'for list item:', element?.dataset?.hypothesisId || 'unknown');
                if (element) {
                    element.style.border = '2px solid #dc2626';
                    element.style.backgroundColor = '#fee2e2';
                }
            }
        }

        // ===== MODAL FUNCTIONS =====
        // Data Modal Functions
        function openDataModal(type, datasetName) {
            console.log('[Modal] Opening data modal for:', type, datasetName);
            const modal = document.getElementById('data-modal');
            if (modal) {
                // Show loading state
                showModalLoading();

                // Load dataset information
                loadDatasetInfo(type, datasetName);

                // Load data preview
                loadDatasetPreview(type, 1, 50); // Default to page 1, 50 rows

                modal.style.display = 'flex';
                modal.setAttribute('aria-hidden', 'false');
                console.log('[Modal] Data modal opened successfully');
            } else {
                console.error('[Modal] Data modal element not found');
            }
        }

        function closeDataModal() {
            console.log('[Modal] Closing data modal');
            const modal = document.getElementById('data-modal');
            if (modal) {
                modal.style.display = 'none';
                modal.setAttribute('aria-hidden', 'true');
                console.log('[Modal] Data modal closed successfully');
            } else {
                console.error('[Modal] Data modal element not found');
            }
        }

        function showModalLoading() {
            const loadingElement = document.getElementById('modal-loading');
            const emptyElement = document.getElementById('modal-empty');
            const tableElement = document.getElementById('modal-table-body');

            if (loadingElement) loadingElement.style.display = 'block';
            if (emptyElement) emptyElement.style.display = 'none';
            if (tableElement) tableElement.innerHTML = '';
        }

        function hideModalLoading() {
            const loadingElement = document.getElementById('modal-loading');
            if (loadingElement) loadingElement.style.display = 'none';
        }

        function loadDatasetInfo(type, datasetName) {
            console.log('[Modal] Loading dataset info for:', type, datasetName);

            fetch(`/api/datasets/${type}`)
                .then(response => response.json())
                .then(data => {
                    console.log('[Modal] Dataset info loaded:', data);

                    // Update modal header
                    updateModalHeader(data, datasetName);

                    // Update dataset stats
                    updateModalStats(data);
                })
                .catch(error => {
                    console.error('[Modal] Error loading dataset info:', error);
                    // Show fallback info
                    updateModalHeader({}, datasetName);
                    updateModalStats({});
                });
        }

        function loadDatasetPreview(type, page, limit) {
            console.log('[Modal] Loading dataset preview for:', type, 'page:', page, 'limit:', limit);

            fetch(`/api/datasets/${type}/preview?page=${page}&limit=${limit}`)
                .then(response => response.json())
                .then(data => {
                    console.log('[Modal] Dataset preview loaded:', data);

                    hideModalLoading();
                    updateModalTable(data);
                    updateModalPagination(data, page, limit);
                })
                .catch(error => {
                    console.error('[Modal] Error loading dataset preview:', error);
                    hideModalLoading();

                    // Show empty state
                    const emptyElement = document.getElementById('modal-empty');
                    if (emptyElement) emptyElement.style.display = 'block';
                });
        }

        function updateModalHeader(data, datasetName) {
            // Update title
            const titleElement = document.getElementById('modal-dataset-name');
            if (titleElement) {
                titleElement.textContent = data.name || datasetName || 'Dataset Details';
            }

            // Update summary/ID
            const summaryElement = document.getElementById('modal-dataset-summary');
            if (summaryElement) {
                summaryElement.textContent = `ID: ${data.id || 'â€”'}`;
            }

            // Update domain
            const domainElement = document.getElementById('modal-dataset-domain');
            if (domainElement) {
                domainElement.textContent = data.domain ? `Domain: ${data.domain}` : '';
                domainElement.style.display = data.domain ? 'block' : 'none';
            }

            // Update description
            const descElement = document.getElementById('modal-dataset-description');
            if (descElement) {
                descElement.textContent = data.description || 'â€”';
                descElement.style.display = data.description ? 'block' : 'none';
            }
        }

        function updateModalStats(data) {
            // Update record count
            const recordCountElement = document.getElementById('modal-record-count');
            if (recordCountElement) {
                recordCountElement.textContent = data.recordCount || 'â€”';
            }

            // Update field count
            const fieldCountElement = document.getElementById('modal-field-count');
            if (fieldCountElement) {
                fieldCountElement.textContent = data.fieldCount || 'â€”';
            }

            // Update missing rate
            const missingRateElement = document.getElementById('modal-missing-rate');
            if (missingRateElement) {
                const rate = data.missingRate;
                missingRateElement.textContent = rate !== undefined ? `${(rate * 100).toFixed(1)}%` : 'â€”%';
            }

            // Update dataset size
            const sizeElement = document.getElementById('modal-dataset-size');
            if (sizeElement) {
                const size = data.fileSize;
                if (size) {
                    const sizeInMB = (size / (1024 * 1024)).toFixed(1);
                    sizeElement.textContent = `${sizeInMB} MB`;
                } else {
                    sizeElement.textContent = 'â€”';
                }
            }
        }

        function updateModalTable(data) {
            const headerElement = document.getElementById('modal-table-header');
            const bodyElement = document.getElementById('modal-table-body');

            if (!headerElement || !bodyElement) return;

            // Clear existing content
            headerElement.innerHTML = '';
            bodyElement.innerHTML = '';

            if (!data.fields || !data.rows) {
                console.warn('[Modal] No fields or rows data available');
                return;
            }

            // Build header row
            const headerRow = document.createElement('tr');
            data.fields.forEach(field => {
                const th = document.createElement('th');
                th.className = 'px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider';
                th.textContent = field.name || field;
                headerRow.appendChild(th);
            });
            headerElement.appendChild(headerRow);

            // Build data rows
            if (data.rows && data.rows.length > 0) {
                data.rows.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.className = 'hover:bg-gray-50';

                    data.fields.forEach((field, index) => {
                        const td = document.createElement('td');
                        td.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-900';
                        const fieldName = field.name || field;
                        td.textContent = row[fieldName] || row[index] || '';
                        tr.appendChild(td);
                    });

                    bodyElement.appendChild(tr);
                });
            } else {
                // No data rows
                const tr = document.createElement('tr');
                const td = document.createElement('td');
                td.colSpan = data.fields.length;
                td.className = 'px-6 py-4 text-center text-sm text-gray-500';
                td.textContent = 'No data available';
                tr.appendChild(td);
                bodyElement.appendChild(tr);
            }
        }

        function updateModalPagination(data, currentPage, limit) {
            const rangeElement = document.getElementById('modal-row-range');
            const currentPageElement = document.getElementById('modal-current-page');
            const totalPagesElement = document.getElementById('modal-total-pages');
            const prevBtn = document.getElementById('modal-prev-btn');
            const nextBtn = document.getElementById('modal-next-btn');

            if (data.totalRows) {
                const startRow = ((currentPage - 1) * limit) + 1;
                const endRow = Math.min(currentPage * limit, data.totalRows);
                const totalPages = Math.ceil(data.totalRows / limit);

                if (rangeElement) {
                    rangeElement.textContent = `Rows ${startRow}-${endRow} of ${data.totalRows}`;
                }

                if (currentPageElement) currentPageElement.textContent = currentPage;
                if (totalPagesElement) totalPagesElement.textContent = totalPages;

                // Update button states
                if (prevBtn) {
                    prevBtn.disabled = currentPage <= 1;
                }
                if (nextBtn) {
                    nextBtn.disabled = currentPage >= totalPages;
                }
            } else {
                // Fallback for when total count is not available
                if (rangeElement) rangeElement.textContent = 'Rows 1-50 of ?';
                if (currentPageElement) currentPageElement.textContent = currentPage;
                if (totalPagesElement) totalPagesElement.textContent = '?';
            }
        }

        function changePage(direction) {
            const currentPageElement = document.getElementById('modal-current-page');
            const totalPagesElement = document.getElementById('modal-total-pages');
            const limitSelect = document.getElementById('modal-limit-select');

            if (!currentPageElement || !totalPagesElement || !limitSelect) return;

            const currentPage = parseInt(currentPageElement.textContent) || 1;
            const totalPages = parseInt(totalPagesElement.textContent) || 1;
            const limit = parseInt(limitSelect.value) || 50;

            let newPage = currentPage;
            if (direction === 'prev' && currentPage > 1) {
                newPage = currentPage - 1;
            } else if (direction === 'next' && currentPage < totalPages) {
                newPage = currentPage + 1;
            }

            if (newPage !== currentPage) {
                showModalLoading();
                loadDatasetPreview('current', newPage, limit);
            }
        }

        function changePageSize() {
            const limitSelect = document.getElementById('modal-limit-select');
            if (!limitSelect) return;

            const limit = parseInt(limitSelect.value) || 50;
            showModalLoading();
            loadDatasetPreview('current', 1, limit); // Reset to page 1 when changing page size
        }

        // Upload Modal Functions
        function showUploadModal() {
            console.log('[Modal] Opening upload modal');
            const modal = document.getElementById('upload-modal');
            if (modal) {
                modal.style.display = 'flex';
                modal.setAttribute('aria-hidden', 'false');
                console.log('[Modal] Upload modal opened successfully');
            } else {
                console.error('[Modal] Upload modal element not found');
            }
        }

        function hideUploadModal() {
            console.log('[Modal] Closing upload modal');
            const modal = document.getElementById('upload-modal');
            if (modal) {
                modal.style.display = 'none';
                modal.setAttribute('aria-hidden', 'true');
                console.log('[Modal] Upload modal closed successfully');
            } else {
                console.error('[Modal] Upload modal element not found');
            }
        }

        // Merge Modal Functions
        function showMergeModal() {
            console.log('[Modal] Opening merge modal');
            const modal = document.getElementById('merge-modal');
            if (modal) {
                modal.style.display = 'flex';
                modal.setAttribute('aria-hidden', 'false');
                console.log('[Modal] Merge modal opened successfully');
            } else {
                console.error('[Modal] Merge modal element not found');
            }
        }

        function hideMergeModal() {
            console.log('[Modal] Closing merge modal');
            const modal = document.getElementById('merge-modal');
            if (modal) {
                modal.style.display = 'none';
                modal.setAttribute('aria-hidden', 'true');
                console.log('[Modal] Merge modal closed successfully');
            } else {
                console.error('[Modal] Merge modal element not found');
            }
        }

        // Workspace Graph Function
        function showWorkspaceGraph(workspaceId) {
            console.log('[Workspace] Showing graph for workspace:', workspaceId);
            // Placeholder for workspace graph functionality
            // Could open a modal or navigate to workspace visualization
            console.log('[Workspace] Workspace graph functionality not implemented yet');
        }

        // Removed terminal-specific effects for clean light mode
    </script>

    <!-- Global Components -->
    {{template "data_modal" .}}
    {{template "upload_modal" .}}
    {{template "merge_modal" .}}
</body>
</html>
{{end}}
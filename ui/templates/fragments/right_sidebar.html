{{define "right-sidebar"}}
<!-- Right Sidebar - DataSpaces Explorer -->
<div class="w-72 flex flex-col bg-white border-l border-slate-200">
    <!-- Minimal Block Header -->
    <div class="flex-shrink-0 p-3 border-b border-slate-200 bg-white">
        <h3 class="text-[11px] font-bold text-slate-900 uppercase tracking-wide">DataSpaces</h3>
    </div>

    <!-- Minimal Block-Based Content -->
    <div class="flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-slate-300 scrollbar-track-slate-100">

        <!-- Dataset Parent Block -->
        <div id="dataset-block" class="mx-3 my-2 bg-white border border-slate-200 rounded cursor-pointer hover:border-slate-300 transition-all duration-200"
             onclick="toggleDatasetFields()">
            <div class="p-3">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                        <!-- Dataset icon -->
                        <div class="w-3 h-3 bg-blue-500 rounded-sm"></div>
                        <div>
                            <div class="text-[10px] font-bold text-slate-900">{{if .DatasetInfo.name}}{{.DatasetInfo.name}}{{else}}Current Dataset{{end}}</div>
                            <div class="text-[8px] text-slate-500">{{len .FieldStats}} fields</div>
                        </div>
                    </div>
                    <!-- Expand/collapse arrow -->
                    <div id="dataset-arrow" class="text-slate-400 text-[8px] transition-transform duration-200">▶</div>
                </div>
            </div>
        </div>

        <!-- Fields Container (Initially Hidden) -->
        <div id="fields-container" class="hidden mx-3 space-y-1">
            {{range .FieldStats}}
            <!-- Field Sub-Block -->
            <div class="bg-white border border-slate-200 rounded cursor-pointer hover:border-slate-300 transition-all duration-200 ml-4"
                 data-field-name="{{.Name}}"
                 data-field-type="{{.Type}}"
                 onclick="selectField('{{.Name}}')">
                <div class="p-2">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2 flex-1 min-w-0">
                            <!-- Quality dot -->
                            <div class="w-1.5 h-1.5 rounded-full flex-shrink-0 {{if gt .MissingRate 0.1}}bg-red-500{{else if gt .MissingRate 0.05}}bg-amber-500{{else}}bg-green-500{{end}}"></div>
                            <!-- Field name -->
                            <div class="font-medium text-slate-900 text-[9px] truncate flex-1" title="{{.Name}}">{{.Name}}</div>
                        </div>
                        <!-- Type badge -->
                        <span class="inline-flex items-center px-1 py-0.5 rounded text-[7px] font-medium border {{if eq .Type "numeric"}}bg-white text-blue-700 border-blue-200{{else}}bg-white text-purple-700 border-purple-200{{end}}">
                            {{if eq .Type "numeric"}}NUM{{else}}CAT{{end}}
                        </span>
                    </div>
                    <!-- Compact stats -->
                    <div class="mt-1 flex items-center justify-between text-[7px] text-slate-500">
                        <span>{{.SampleSize}} samples</span>
                        <span>{{if gt .InRelationships 0}}{{.InRelationships}} rel{{else}}—{{end}}</span>
                    </div>
                </div>
            </div>
            {{end}}
        </div>
    </div>

    <!-- Minimal Block JavaScript -->
    <script>
        let isDatasetExpanded = false;

        function toggleDatasetFields() {
            const container = document.getElementById('fields-container');
            const arrow = document.getElementById('dataset-arrow');
            const datasetBlock = document.getElementById('dataset-block');

            isDatasetExpanded = !isDatasetExpanded;

            if (isDatasetExpanded) {
                container.classList.remove('hidden');
                arrow.style.transform = 'rotate(90deg)';
                datasetBlock.classList.add('border-slate-300');
            } else {
                container.classList.add('hidden');
                arrow.style.transform = 'rotate(0deg)';
                datasetBlock.classList.remove('border-slate-300');
            }
        }

        function selectField(fieldName) {
            // Remove selection from all field blocks
            document.querySelectorAll('#fields-container > div').forEach(block => {
                block.classList.remove('border-blue-500', 'bg-blue-50');
                block.classList.add('border-slate-200', 'bg-white');
            });

            // Add selection to clicked field block
            event.currentTarget.classList.remove('border-slate-200', 'bg-white');
            event.currentTarget.classList.add('border-blue-500', 'bg-blue-50');

            // Here you could trigger additional actions like showing field details
            // or sending the selection to the center panel
            console.log('Selected field:', fieldName);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Dataset starts collapsed
            isDatasetExpanded = false;
        });
    </script>
</div>
{{end}}


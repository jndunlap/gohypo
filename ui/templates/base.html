<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>{{.Title}}</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10/dist/ext/ws.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        // The "Extraction" Scheme
                        'void': {
                            DEFAULT: '#020202',
                            50: '#f5f5f5',
                            100: '#e5e5e5',
                            200: '#d4d4d4',
                            300: '#a3a3a3',
                            400: '#737373',
                            500: '#525252',
                            600: '#404040',
                            700: '#262626',
                            800: '#1a1a1a',
                            900: '#0a0a0a',
                        },
                        'obsidian': {
                            DEFAULT: '#0d0d0d',
                            50: '#f8f9fa',
                            100: '#e9ecef',
                            200: '#dee2e6',
                            300: '#ced4da',
                            400: '#adb5bd',
                            500: '#6c757d',
                            600: '#495057',
                            700: '#343a40',
                            800: '#212529',
                            900: '#0d0d0d',
                        },
                        'cold-steel': '#222222',
                        'hyper-lime': {
                            DEFAULT: '#00ff41',
                            50: '#f0fff4',
                            100: '#d1ffdd',
                            200: '#a3ffbb',
                            300: '#75ff99',
                            400: '#47ff77',
                            500: '#00ff41',
                            600: '#00cc34',
                            700: '#009927',
                            800: '#00661a',
                            900: '#00330d',
                        },
                        'crimson-ghost': {
                            DEFAULT: '#ff003c',
                            50: '#fef2f2',
                            100: '#fee2e2',
                            200: '#fecaca',
                            300: '#fca5a5',
                            400: '#f87171',
                            500: '#ef4444',
                            600: '#ff003c',
                            700: '#b91c1c',
                            800: '#991b1b',
                            900: '#7f1d1d',
                        },
                        'electric-cobalt': {
                            DEFAULT: '#2e5bff',
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2e5bff',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        },
                        'ghost-white': '#f5f5f5',
                        'faint-gray': '#111111',
                        'ghost-gray': '#444444',

                        // Semantic aliases
                        'validated': 'var(--hyper-lime)',
                        'vetoed': 'var(--crimson-ghost)',
                        'system': 'var(--electric-cobalt)',
                        'metadata': 'var(--ghost-gray)',
                    },
                    fontFamily: {
                        'satoshi': ['Satoshi', 'system-ui', 'sans-serif'],
                        'inter': ['Inter', 'system-ui', 'sans-serif'],
                        'mono': ['JetBrains Mono', 'SF Mono', 'Monaco', 'Inconsolata', 'monospace'],
                    },
                    fontSize: {
                        'tactical': ['0.875rem', { lineHeight: '1.25', letterSpacing: '0.08em', fontWeight: '700', textTransform: 'uppercase' }],
                        'computed': ['0.875rem', { lineHeight: '1.5', fontFamily: 'JetBrains Mono' }],
                        'narrative': ['1rem', { lineHeight: '1.6' }],
                    },
                    spacing: {
                        '18': '4.5rem',
                        '88': '22rem',
                        '128': '32rem',
                    },
                    borderWidth: {
                        '3': '3px',
                    },
                    animation: {
                        'integrity-pulse': 'integrity-pulse 3s ease-in-out infinite',
                        'logic-scroll': 'logic-scroll 20s linear infinite',
                    },
                    keyframes: {
                        'integrity-pulse': {
                            '0%, 100%': { boxShadow: '0 0 0 0 rgba(0, 255, 65, 0.4)' },
                            '50%': { boxShadow: '0 0 0 2px rgba(0, 255, 65, 0.4)' },
                        },
                        'logic-scroll': {
                            '0%': { transform: 'translateX(100%)' },
                            '100%': { transform: 'translateX(-100%)' },
                        },
                    },
                    boxShadow: {
                        'tactical': '0 0 8px rgba(0, 255, 65, 0.1)',
                        'vetoed': '0 0 8px rgba(255, 0, 60, 0.1)',
                        'system': '0 0 8px rgba(46, 91, 255, 0.1)',
                    },
                }
            }
        }
    </script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/css/main.css">
</head>
<body class="forensic-container selection:bg-hyper-lime selection:text-void">
    <!-- Fingerprint Margin (Vertical Technical Proof) -->
    <aside class="fingerprint-margin hidden lg:flex fixed left-0 top-0 h-full w-64 z-10">
        <div class="fingerprint-content absolute top-4 left-4 right-4">
            <div class="text-xs font-mono text-ghost-gray mb-2">
                {{if .Fingerprint}}FINGERPRINT: {{.Fingerprint}}{{end}}
            </div>
            <div class="text-xs font-mono text-ghost-gray">
                {{if .DatasetInfo.snapshotID}}SNAPSHOT_ID: {{.DatasetInfo.snapshotID}}{{else}}SNAPSHOT_ID: NULL{{end}}
            </div>
        </div>
        <div class="dossier-panel absolute bottom-4 left-4 right-4">
            <h4 class="tactical-header text-[10px] text-ghost-gray mb-4">FORENSIC FINGERPRINT DOSSIER</h4>
            <div class="space-y-6">
                <div>
                    <div class="tactical-header text-[8px] text-ghost-gray mb-1">EXECUTION FINGERPRINT</div>
                    <div class="computed-value text-[10px] text-ghost-white break-all cursor-pointer hover:text-hyper-lime transition-colors"
                         onclick="navigator.clipboard.writeText('gohypo-cli replay --fingerprint {{.Fingerprint}}')">
                        {{.Fingerprint}}
                    </div>
                </div>
                <div>
                    <div class="tactical-header text-[8px] text-ghost-gray mb-1">REGISTRY HASH</div>
                    <div class="computed-value text-[10px] text-ghost-white break-all">
                        {{if .RegistryHash}}{{.RegistryHash}}{{else}}sha256:8f3a2b1c...{{end}}
                    </div>
                </div>
                <div class="pt-4 border-t border-cold-steel">
                    <div class="computed-value text-[9px] text-hyper-lime cursor-pointer"
                         onclick="navigator.clipboard.writeText('gohypo-cli replay --fingerprint {{.Fingerprint}} --stage L0')">
                        REPLAY_L0_MAPPING
                    </div>
                </div>
            </div>
        </div>
    </aside>

    <!-- Navigation -->
    <nav class="border-b border-cold-steel bg-obsidian">
        <div class="max-w-full mx-auto px-4 sm:px-6 lg:ml-64">
            <div class="flex justify-between items-center h-14">
                <div class="flex-shrink-0 flex items-center gap-3">
                    <span class="text-xs font-mono text-ghost-gray">
                        {{if .DatasetInfo.snapshotID}}SNAPSHOT_ID: {{.DatasetInfo.snapshotID}}{{else}}SNAPSHOT_ID: NULL{{end}}
                    </span>
                    <span class="text-lg font-bold tracking-widest uppercase text-ghost-white font-mono leading-none">
                        GoHypo <span class="text-[10px] ml-2 text-ghost-gray align-middle">v0.1.0-alpha</span>
                    </span>
                </div>
                <div class="hidden sm:flex items-center space-x-6">
                    <a href="/" class="tactical-header text-sm text-ghost-white hover:text-hyper-lime transition-colors leading-none">DASHBOARD</a>
                    <a href="/contracts" class="tactical-header text-sm text-ghost-white hover:text-hyper-lime transition-colors leading-none">CONTRACTS</a>
                    <a href="/ledger" class="tactical-header text-sm text-ghost-white hover:text-hyper-lime transition-colors leading-none">LEDGER</a>
                    <a href="/directives" class="tactical-header text-sm text-ghost-white hover:text-hyper-lime transition-colors leading-none">DIRECTIVES</a>
                    <a href="/telemetry" class="tactical-header text-sm text-ghost-white hover:text-hyper-lime transition-colors leading-none">TELEMETRY</a>
                    <a href="/vitality" class="tactical-header text-sm text-ghost-white hover:text-hyper-lime transition-colors leading-none">VITALITY</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="lg:ml-64">
        {{block "content" .}}{{end}}
    </main>

    <!-- Logic Pulse - Footer Heartbeat -->
    <div class="logic-pulse logic-pulse--collapsed" id="logic-pulse">
        <button class="logic-pulse-toggle" type="button" onclick="toggleLogicPulse()" aria-label="Toggle logic pulse">
            LOGIC_PULSE
            <span class="logic-pulse-caret" aria-hidden="true">â–¾</span>
        </button>
        <div class="logic-pulse-content" aria-live="polite">
            <span class="text-electric-cobalt">[SYSTEM]</span> APPEND_ONLY_LEDGER_ACTIVE |
            <span class="text-hyper-lime">[VALIDATED]</span> ARTIFACT_COMMITTED_SHA256_ABC123... |
            <span class="text-ghost-gray">[HEARTBEAT]</span> REGISTRY_PULSE_STABLE |
            <span class="text-electric-cobalt">[TELEMETRY]</span> DETERMINISTIC_STATE_1_0_0 |
            <span class="text-hyper-lime">[SIGNAL]</span> RELATIONSHIP_EXTRACTED_R_0_67 |
            <span class="text-ghost-gray">[IDLE]</span> AWAITING_DIRECTIVE_INPUT |
        </div>
        <div class="logic-pulse-fade" aria-hidden="true"></div>
    </div>

    <!-- HTMX Configuration -->
    <script>
        // Global HTMX config
        htmx.config.globalViewTransitions = true;
        htmx.config.useTemplateFragments = true;

        // Loading indicators
        document.body.addEventListener('htmx:beforeRequest', function(evt) {
            const btn = evt.target.querySelector('button[type="submit"], button[aria-busy]');
            if (btn) {
                btn.setAttribute('aria-busy', 'true');
                btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Processing...';
            }
            // Add loading class to target
            const target = document.querySelector(evt.detail.target);
            if (target) {
                target.classList.add('htmx-loading');
            }
        });

        document.body.addEventListener('htmx:afterRequest', function(evt) {
            const btn = evt.target.querySelector('button[aria-busy]');
            if (btn) {
                btn.removeAttribute('aria-busy');
            }
            // Remove loading class from target
            const target = document.querySelector(evt.detail.target);
            if (target) {
                target.classList.remove('htmx-loading');
            }
        });

        // Error handling
        document.body.addEventListener('htmx:responseError', function(evt) {
            console.error('HTMX Error:', evt.detail);
            // Could show toast notification here
        });
        // Logic Veil Toggle (Architectural Easter Egg: Ctrl + /)
        window.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === '/') {
                document.body.classList.toggle('logic-veil-active');
                if (document.body.classList.contains('logic-veil-active')) {
                    const notify = document.createElement('div');
                    notify.className = 'fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-[300] bg-void border border-hyper-lime p-8 shadow-tactical animate-pulse';
                    notify.innerHTML = '<div class="tactical-header text-xl text-hyper-lime">Logic Veil Activated</div><div class="computed-value text-xs text-ghost-gray mt-2 uppercase">Rendering Architectural Layers...</div>';
                    document.body.appendChild(notify);
                    setTimeout(() => notify.remove(), 2000);
                }
            }
        });

        function toggleLogicPulse() {
            const el = document.getElementById('logic-pulse');
            if (!el) return;
            const collapsed = el.classList.toggle('logic-pulse--collapsed');
            el.classList.toggle('logic-pulse--expanded', !collapsed);
        }
    </script>
</body>
</html>